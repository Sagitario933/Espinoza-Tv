<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Espinoza Tv</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" href="img/favicon.png" type="image/png" />
  <style>
    :root {
      --bg: #0f1115;
      --bg-alt: #1a1d23;
      --bg-panel: #14171d;
      --border: #2a3039;
      --accent: #ffd700;
      --accent-glow: 0 0 0 1px #ffd70055,0 0 12px #ffd70055;
      --text: #e6e7e9;
      --text-dim: #9aa0ad;
      --radius-sm: 6px;
      --radius-md: 12px;
      --transition: .18s cubic-bezier(.4,.2,.2,1);
      --header-h: 56px;
      --footer-h: 30px;
      font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;
    }
    * { box-sizing: border-box; }
    html, body { height:100%; }
    body { margin:0; background: var(--bg); color: var(--text); -webkit-font-smoothing: antialiased; overflow:hidden; }
    .app-header { display:flex; align-items:center; gap:12px; padding:0 18px; height:var(--header-h); background:linear-gradient(90deg,#0f1115,#171c23); border-bottom:1px solid var(--border); position:relative; z-index:30; }
  .logo-mark { display:flex; align-items:center; justify-content:center; }
  .logo-mark img { height:40px; width:auto; display:block; object-fit:contain; }
    .brand { font-size:1.05rem; font-weight:600; letter-spacing:.5px; }
  .container { display:flex; height:calc(100vh - var(--header-h) - var(--footer-h)); min-height:0; }
    .sidebar { width:310px; max-width:310px; display:flex; flex-direction:column; background:var(--bg-panel); border-right:1px solid var(--border); }
    .sidebar-header { padding:18px 18px 12px; }
    .sidebar-header h2 { margin:0 0 12px; font-size:.95rem; font-weight:600; text-transform:uppercase; letter-spacing:1px; color:var(--accent); }
    .search { width:100%; padding:10px 12px; border:1px solid var(--border); background:#101318; color:var(--text); border-radius: var(--radius-sm); outline:none; font-size:.85rem; transition: var(--transition); }
    .search:focus { border-color: var(--accent); box-shadow: var(--accent-glow); }
    .channel-list { flex:1; overflow-y:auto; padding:4px 10px 14px 14px; scrollbar-width: thin; scrollbar-color: #2d323b #121418; }
    .channel-list::-webkit-scrollbar { width:10px; }
    .channel-list::-webkit-scrollbar-track { background:#121418; }
    .channel-list::-webkit-scrollbar-thumb { background:#232830; border-radius:20px; border:2px solid #121418; }
    .channel-list::-webkit-scrollbar-thumb:hover { background:#303741; }
    .empty-msg { padding:32px 8px; text-align:center; font-size:.8rem; color:var(--text-dim); }
    .channel { position:relative; display:flex; align-items:center; gap:12px; padding:10px 12px 10px 10px; margin:0 0 6px; background:linear-gradient(145deg,#161a20,#12151a); border:1px solid #1d2229; border-radius:var(--radius-sm); cursor:pointer; outline:none; transition: var(--transition); font-size:.8rem; line-height:1.1; }
    .channel:hover { background:#1d2229; }
    .channel:focus-visible { border-color: var(--accent); box-shadow: var(--accent-glow); }
    .channel.selected { background:#20262f; border-color: var(--accent); box-shadow: var(--accent-glow); }
    .ch-logo { width:38px; height:38px; flex:0 0 38px; border-radius:8px; background:#0e1013; display:flex; align-items:center; justify-content:center; overflow:hidden; border:1px solid #242a32; position:relative; }
    .ch-logo img { width:100%; height:100%; object-fit:contain; display:block; }
    .ch-meta { flex:1; display:flex; flex-direction:column; min-width:0; }
    .ch-name { font-weight:600; font-size:.78rem; letter-spacing:.3px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  .main { flex:1; display:flex; flex-direction:column; background:radial-gradient(circle at 35% 20%,#1d232c,#0f1115 70%); position:relative; overflow:hidden; }
  .player-box { margin:auto; width:min(94%,1000px); max-height:100%; background:linear-gradient(145deg,#14181f 0%,#101317 60%); border:1px solid #20262f; border-radius:var(--radius-md); padding:18px 20px 16px; display:flex; flex-direction:column; gap:14px; box-shadow:0 8px 28px -10px #000a,0 0 0 1px #ffffff05; position:relative; }
    .player-top { display:flex; align-items:center; gap:10px; width:100%; }
    .indicator { width:10px; height:10px; border-radius:50%; background:#555; box-shadow:0 0 0 3px #ffffff07; transition: var(--transition); }
    .indicator.playing { background:#00c853; box-shadow:0 0 0 3px #00c85330,0 0 8px #00c85388; }
    .indicator.error { background:#ff1744; box-shadow:0 0 0 3px #ff174430,0 0 8px #ff174488; }
    .channel-title { font-size:.95rem; font-weight:600; letter-spacing:.5px; color:var(--accent); margin:0; flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .status-badge { font-size:.55rem; background:#222b33; padding:4px 8px; border-radius:20px; letter-spacing:.6px; color:var(--text-dim); text-transform:uppercase; border:1px solid #2a333d; }
  .video-wrap { position:relative; width:100%; display:flex; border:1px solid #1f242b; border-radius:10px; overflow:hidden; background:#000; }
  video { width:100%; aspect-ratio:16/9; background:#000; outline:none; }
  .footer { position:fixed; left:0; right:0; bottom:0; height:var(--footer-h); display:flex; align-items:center; justify-content:center; text-align:center; font-size:.6rem; padding:0 10px; color:var(--text-dim); letter-spacing:.4px; background:#0f1115; border-top:1px solid var(--border); }
    .footer a { color:var(--accent); text-decoration:none; }
    .footer a:hover { text-decoration:underline; }
    /* Responsive */
  @media (max-width: 1080px) { body { overflow:auto; } .footer { position:static; height:auto; padding:16px 10px 24px; } .container { height:auto; flex-direction:column; } .sidebar { width:100%; max-width:none; border-right:none; border-bottom:1px solid var(--border);} .channel-list { display:flex; flex-wrap:wrap; max-height:38vh; overflow-y:auto; padding-right:6px; } .channel { flex:1 1 160px; min-width:145px; } .main { height:auto; padding:12px 0 24px; overflow:visible; } .player-box { width:100%; margin-top:14px; max-height:none; } }
    @media (max-width: 640px) { .channel { gap:8px; padding:8px 10px; } .ch-logo { width:34px; height:34px; } .ch-name { font-size:.7rem; } .ch-src { display:none; } .player-box { padding:14px 14px 12px; border-radius:10px; } .channel-title { font-size:.85rem; } video { aspect-ratio:16/9; } }
    @media (prefers-reduced-motion: reduce) { * { animation: none !important; transition:none !important; } }
  </style>
</head>
<body>
  <header class="app-header" role="banner">
    <div class="logo-mark">
      <img src="img/favicon.png" alt="Espinoza TV">
    </div>
    <div class="brand" aria-label="Nombre de la aplicación">Espinoza TV</div>
  </header>
  <div class="container" role="application">
    <aside class="sidebar" aria-label="Lista de canales">
      <div class="sidebar-header">
        <h2>Canales</h2>
        <input class="search" type="text" id="search" placeholder="Buscar canal..." aria-label="Buscar canal" />
      </div>
      <div class="channel-list" id="channelList" tabindex="0" role="list" aria-live="polite"></div>
    </aside>
    <main class="main">
      <section class="player-box" aria-label="Reproductor">
        <div class="player-top">
          <div class="indicator" id="playIndicator" aria-hidden="true"></div>
          <h1 class="channel-title" id="channelTitle">Selecciona un canal</h1>
          <div class="status-badge" id="streamStatus">Idle</div>
        </div>
        <div class="video-wrap" id="videoWrap">
          <video id="video" controls playsinline preload="none" tabindex="0" aria-label="Video del canal"></video>
        </div>
      </section>
    </main>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script>
    // Modo compatibilidad: evitar features muy modernos para mayor soporte
    (function(){ 'use strict';
    var channels = [
      { name: "Vision Sur", logo: "https://upload.wikimedia.org/wikipedia/commons/8/8e/Vision_Sur_logo.png", url: "https://ott1.hdlatam.tv/live_abr/webtvVisionSur/playlist.m3u8" },
      { name: "Latina", logo: "https://upload.wikimedia.org/wikipedia/commons/2/2e/Latina_Television_logo.png", url: "https://live-evg25.tv360.bitel.com.pe/bitel/latina/playlist.m3u8" },
      { name: "Turbo Mix Radio TV", logo: "https://yt3.googleusercontent.com/ytc/AIdro_mQwQwQwQwQwQwQwQwQwQwQwQwQwQwQwQw=s900-c-k-c0x00ffffff-no-rj", url: "https://7.innovatestream.pe:19360/turbomixoficial/turbomixoficial.m3u8" },
      { name: "Autentica TV", logo: "https://autenticatv.pe/wp-content/uploads/2021/09/logo-autentica-tv.png", url: "https://live.obslivestream.com/autenticatvmux/index.m3u8" },
      { name: "Bethel TV", logo: "https://alfa.betheltv.tv/assets/img/logo.png", url: "https://alfa.betheltv.tv/srt/3_abr/playlist.m3u8" },
      { name: "Corporation HC", logo: "https://video.misistemareseller.com/corporationhc/logo.png", url: "https://video.misistemareseller.com/corporationhc/corporationhc/playlist.m3u8" },
      { name: "DMJ Sur TV", logo: "https://stmv1.voxhdnet.com/dmjsurtv/dmjsurtv/logo.png", url: "https://stmv1.voxhdnet.com/dmjsurtv/dmjsurtv/playlist.m3u8" },
      { name: "Impacto TV", logo: "https://cloudvideo.servers10.com:8081/impactotv/logo.png", url: "https://cloudvideo.servers10.com:8081/impactotv/index.m3u8" },
      { name: "Cable Peru", logo: "https://video2.lhdserver.es/cableperu/logo.png", url: "https://video2.lhdserver.es/cableperu/live.m3u8" },
      { name: "JNE TV", logo: "https://live20.bozztv.com/akamaissh101/ssh101/jnetv/logo.png", url: "https://live20.bozztv.com/akamaissh101/ssh101/jnetv/playlist.m3u8" },
      { name: "Latina 2", logo: "https://redirector.rudo.video/hls-video/plus226/latina2/logo.png", url: "https://redirector.rudo.video/hls-video/plus226/latina2/latina2.smil/playlist.m3u8" },
      { name: "Miel TV", logo: "https://7.innovatestream.pe:19360/mieltv/logo.png", url: "https://7.innovatestream.pe:19360/mieltv/mieltv.m3u8" },
      { name: "Milenial News", logo: "https://www.milenial.news/logo.png", url: "https://www.milenial.news/salida/milenial.m3u8" },
      { name: "NQVNHUJHRX", logo: "https://videoserver.tmcreativos.com:19360/nqvnhujhrx/logo.png", url: "https://videoserver.tmcreativos.com:19360/nqvnhujhrx/nqvnhujhrx.m3u8" },
      { name: "Hipodromo JCP2", logo: "https://www.opencaster.com/resources/hls_stream/logo.png", url: "https://www.opencaster.com/resources/hls_stream/hipodromojcp2.m3u8" },
      { name: "Nativa 1", logo: "https://oneplay.iptvperu.tv:1936/static/nativa1.stream/logo.png", url: "https://oneplay.iptvperu.tv:1936/static/nativa1.stream/chunks.m3u8" },
      { name: "Nativa TV", logo: "https://7.innovatestream.pe:19360/nativatv/logo.png", url: "https://7.innovatestream.pe:19360/nativatv/nativatv.m3u8" },
      { name: "Onda Digital", logo: "https://tv.ondadigital.pe/ondadigital/logo.png", url: "https://tv.ondadigital.pe/ondadigital/index.m3u8" },
      { name: "Ovacion 1 TV", logo: "http://cdn2.ujjina.com:1935/iptvovacion1/liveovacion1tv/logo.png", url: "http://cdn2.ujjina.com:1935/iptvovacion1/liveovacion1tv/playlist.m3u8" },
      { name: "20000", logo: "https://panel.host-live.com:19360/20000/logo.png", url: "https://panel.host-live.com:19360/20000/20000.m3u8" },
      { name: "Planeta TV", logo: "https://live.obslivestream.com/planetatv/logo.png", url: "https://live.obslivestream.com/planetatv/index.m3u8" },
      { name: "Radio Master", logo: "https://videoserver.tmcreativos.com:19360/radiomaster/logo.png", url: "https://videoserver.tmcreativos.com:19360/radiomaster/radiomaster.m3u8" },
      { name: "Radio Onda Digital TV", logo: "https://v4.tustreaming.cl/radioondadigitaltv/logo.png", url: "https://v4.tustreaming.cl/radioondadigitaltv/index.m3u8" },
      { name: "Radiotropical", logo: "https://videoserver.tmcreativos.com:19360/raditropical/logo.png", url: "https://videoserver.tmcreativos.com:19360/raditropical/raditropical.m3u8" },
      { name: "TV Oriente", logo: "https://live.obslivestream.com/tvoriente/logo.png", url: "https://live.obslivestream.com/tvoriente/index.m3u8" },
      { name: "RCR Peru TV", logo: "https://5c3fb01839654.streamlock.net:1963/iptvrcrperu/logo.png", url: "https://5c3fb01839654.streamlock.net:1963/iptvrcrperu/livercrperutv/playlist.m3u8" },
      { name: "Selva TV", logo: "https://live.obslivestream.com/selvatv/logo.png", url: "https://live.obslivestream.com/selvatv/index.m3u8" },
      { name: "Sol TV", logo: "https://video03.logicahost.com.br/soltv/logo.png", url: "https://video03.logicahost.com.br/soltv/soltv/playlist.m3u8" },
      { name: "Super Canal", logo: "https://live.obslivestream.com/supercanal/logo.png", url: "https://live.obslivestream.com/supercanal/index.m3u8" },
      { name: "Telecolor", logo: "https://live.obslivestream.com/telecolormux/logo.png", url: "https://live.obslivestream.com/telecolormux/index.m3u8" },
      { name: "TV Noticias Satipo", logo: "https://7.innovatestream.pe:19360/tvnoticiassatipo/logo.png", url: "https://7.innovatestream.pe:19360/tvnoticiassatipo/tvnoticiassatipo.m3u8" },
      { name: "Tarapoto TV", logo: "https://ott1.hdlatam.tv/live_abr/webtvTarapotoPe/logo.png", url: "https://ott1.hdlatam.tv/live_abr/webtvTarapotoPe/playlist.m3u8" },
      { name: "Top TV Aguaytia", logo: "https://tvdatta.com:3084/live/toptvaguaytialive/logo.png", url: "https://tvdatta.com:3084/live/toptvaguaytialive.m3u8" },
      { name: "Trivu", logo: "https://www.chasquirouter.com/salida/sd/logo.png", url: "https://www.chasquirouter.com/salida/sd/trivu.m3u8" },
      { name: "Cable Rasvia", logo: "https://videoserver.tmcreativos.com:19360/cablerasvia/logo.png", url: "https://videoserver.tmcreativos.com:19360/cablerasvia/cablerasvia.m3u8" },
      { name: "Viva TV", logo: "https://live.obslivestream.com/vivatv/logo.png", url: "https://live.obslivestream.com/vivatv/index.m3u8" },
      { name: "Vision Noticias", logo: "https://videoserver.tmcreativos.com:19360/visionnoticias/logo.png", url: "https://videoserver.tmcreativos.com:19360/visionnoticias/visionnoticias.m3u8" },
      { name: "Urano TV", logo: "https://live.obslivestream.com/uraniotv/logo.png", url: "https://live.obslivestream.com/uraniotv/index.m3u8" },
      { name: "Via Alto Mayo", logo: "https://live.obslivestream.com/viaaltomayomux/logo.png", url: "https://live.obslivestream.com/viaaltomayomux/index.m3u8" },
      { name: "Sistemascusco", logo: "https://stmv1.voxhdnet.com/sistemascusco/logo.png", url: "https://stmv1.voxhdnet.com/sistemascusco/sistemascusco/playlist.m3u8" },
      { name: "Obslivestream Uranio TV", logo: "https://live.obslivestream.com/uraniotv/logo.png", url: "https://live.obslivestream.com/uraniotv/index.m3u8" },
      { name: "Obslivestream Via Alto Mayo", logo: "https://live.obslivestream.com/viaaltomayomux/logo.png", url: "https://live.obslivestream.com/viaaltomayomux/index.m3u8" }
    ];

    var channelList = document.getElementById('channelList');
    var channelTitle = document.getElementById('channelTitle');
    var video = document.getElementById('video');
    var search = document.getElementById('search');
    var indicator = document.getElementById('playIndicator');
    var streamStatus = document.getElementById('streamStatus');
    var selectedIndex = -1;
    var focusPanel = 'channels';
  var lastFilter = null; // null fuerza el primer render
    var defaultLogo = 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="120" height="120" viewBox="0 0 120 120"><rect width="120" height="120" rx="16" fill="%231a1d23"/><text x="50%" y="54%" dominant-baseline="middle" text-anchor="middle" font-family="Arial" font-size="40" fill="%23ffd700">TV</text><text x="50%" y="78%" dominant-baseline="middle" text-anchor="middle" font-family="Arial" font-size="16" fill="%239aa0ad">LIVE</text></svg>';

    function clearChildren(node){ while(node.firstChild) node.removeChild(node.firstChild); }

    function buildChannelNode(channel, idx){
      var div = document.createElement('div');
      div.className = 'channel' + (idx === selectedIndex ? ' selected' : '');
      div.setAttribute('role','listitem');
      div.setAttribute('tabindex','0');
      div.dataset.index = idx;
      var logoWrap = document.createElement('div');
      logoWrap.className = 'ch-logo';
      var img = document.createElement('img');
      img.loading = 'lazy';
      img.alt = 'Logo ' + channel.name;
      img.src = channel.logo || defaultLogo;
      img.onerror = function(){ this.onerror=null; this.src = defaultLogo; };
      logoWrap.appendChild(img);
      var meta = document.createElement('div');
      meta.className = 'ch-meta';
      var name = document.createElement('div'); name.className='ch-name'; name.textContent = channel.name;
  meta.appendChild(name);
      div.appendChild(logoWrap); div.appendChild(meta);
      div.addEventListener('click', function(){ selectChannel(idx); });
      div.addEventListener('keydown', function(ev){ if(ev.key==='Enter' || ev.key===' '){ ev.preventDefault(); selectChannel(idx); }});
      return div;
    }

    function renderChannels(filter){
      filter = (typeof filter === 'string') ? filter : '';
      // Solo omitir reconstrucción si ya existe contenido
      if(filter === lastFilter && channelList.children.length){
        var items = channelList.children;
        for(var i=0;i<items.length;i++){ var c=items[i]; if(parseInt(c.dataset.index,10)===selectedIndex) c.classList.add('selected'); else c.classList.remove('selected'); }
        return;
      }
      lastFilter = filter;
      clearChildren(channelList);
      var any = false;
      for(var i=0;i<channels.length;i++){
        var ch = channels[i];
        if(ch.name.toLowerCase().indexOf(filter.toLowerCase()) !== -1){
          any = true;
          channelList.appendChild(buildChannelNode(ch,i));
        }
      }
      if(!any){
        var m = document.createElement('div'); m.className='empty-msg'; m.textContent='Sin resultados'; channelList.appendChild(m); }
    }

    function updateIndicator(state){
      indicator.classList.remove('playing','error');
      if(state==='playing'){ indicator.classList.add('playing'); }
      else if(state==='error'){ indicator.classList.add('error'); }
    }


    function selectChannel(idx){
      if(idx < 0 || idx >= channels.length) return;
      selectedIndex = idx;
      renderChannels(search.value);
      var ch = channels[idx];
      channelTitle.textContent = ch.name;
      streamStatus.textContent = 'Cargando';
      updateIndicator();
      playM3U8(ch.url);
    }

    function resetPlayer(){ try { if(window.hls){ window.hls.destroy(); window.hls=null; } } catch(e){} video.removeAttribute('src'); video.load(); }

    function playM3U8(url){
      resetPlayer();
      if(window.Hls && Hls.isSupported()){
        window.hls = new Hls({ enableWorker: true, lowLatencyMode: true });
        window.hls.loadSource(url);
        window.hls.attachMedia(video);
        window.hls.on(Hls.Events.MANIFEST_PARSED, function(){ video.play().catch(function(){}); });
  window.hls.on(Hls.Events.LEVEL_LOADED, function(){ streamStatus.textContent='Conectado'; });
  window.hls.on(Hls.Events.ERROR, function(evt,data){ if(data && data.fatal){ streamStatus.textContent='Error'; updateIndicator('error'); try{window.hls.destroy();}catch(e){} } });
      } else if(video.canPlayType && video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = url;
        video.addEventListener('loadedmetadata', function onMeta(){ video.removeEventListener('loadedmetadata', onMeta); video.play().catch(function(){}); });
      } else {
  streamStatus.textContent='No soportado'; updateIndicator('error'); return; }
    }

    // Eventos de video
  video.addEventListener('playing', function(){ streamStatus.textContent='Reproduciendo'; updateIndicator('playing'); });
  video.addEventListener('waiting', function(){ streamStatus.textContent='Recargando...'; updateIndicator(); });
  video.addEventListener('pause', function(){ streamStatus.textContent='Pausado'; updateIndicator(); });
  video.addEventListener('error', function(){ streamStatus.textContent='Error'; updateIndicator('error'); });

    // Navegación por teclado global simplificada
    document.addEventListener('keydown', function(e){
      if(document.activeElement === search) return;
      if(focusPanel === 'channels'){
        if(e.key === 'ArrowDown'){ e.preventDefault(); moveSelection(1); }
        else if(e.key === 'ArrowUp'){ e.preventDefault(); moveSelection(-1); }
        else if(e.key === 'Enter'){ e.preventDefault(); if(selectedIndex === -1) moveSelection(1); else selectChannel(selectedIndex); }
        else if(e.key === 'ArrowRight'){ focusPanel='player'; video.focus(); }
      } else if(focusPanel === 'player') {
        if(e.key === 'ArrowLeft'){ focusPanel='channels'; channelList.focus(); }
      }
    });

    function moveSelection(delta){
      var filtered = [];
      var filter = search.value.toLowerCase();
      for(var i=0;i<channels.length;i++){ if(channels[i].name.toLowerCase().indexOf(filter)!==-1) filtered.push(i); }
      if(!filtered.length) return;
      if(selectedIndex === -1 || filtered.indexOf(selectedIndex) === -1){ selectedIndex = filtered[0]; }
      else {
        var pos = filtered.indexOf(selectedIndex); pos = (pos + delta + filtered.length) % filtered.length; selectedIndex = filtered[pos];
      }
      renderChannels(filter);
      ensureSelectionVisible();
    }

    function ensureSelectionVisible(){
      var items = channelList.querySelectorAll('.channel');
      for(var i=0;i<items.length;i++){
        var el = items[i];
        if(parseInt(el.dataset.index,10) === selectedIndex){
          el.scrollIntoView({ block:'nearest' });
          break;
        }
      }
    }

    // Búsqueda
    var searchDebounce;
    search.addEventListener('input', function(){
      if(searchDebounce) clearTimeout(searchDebounce);
      searchDebounce = setTimeout(function(){ renderChannels(search.value); }, 140);
    });

    // Inicialización
    renderChannels('');
    // Auto-seleccionar el primero visible
    moveSelection(0);
    // Foco inicial en lista
    channelList.focus();
    })();
  </script>
  <div class="footer">Espinoza TV &copy; 2025 · Proyecto personal · </div>
</body>
</html>